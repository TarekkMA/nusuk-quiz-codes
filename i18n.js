const TRANSLATIONS = {
    ar: {
        skipLink: 'ุชุฎุทู ุฅูู ุงููุญุชูู ุงูุฑุฆูุณู',
        logoAlt: 'ุดุนุงุฑ ููุงุชูุญ ูุณู',
        title: 'ููุงุชูุญ ูุณู ูุฌุงููุฉ',
        subtitle: 'ูุณุงุจูุฉ ูุณู ุงูุฑูุถุงููุฉ ูกูคูคูงูู โ ุงุฑุจุญ ุนูุฑุฉ ูููููุง',
        loading: 'ุฌุงุฑู ุงูุชุญููู...',
        codeHint: 'ุงุถุบุท ููุณุฎ ุงูุฑูุฒ. ุงุถุบุท ููุชุงุญ ุงููุณุงูุฉ ุฃู Enter ููุฑูุฒ ุงูุชุงูู.',
        copy: 'ูุณุฎ',
        copyAria: 'ูุณุฎ ุงูุฑูุฒ ุงูุญุงูู',
        openLink: 'ูุชุญ ุงูุฑุงุจุท',
        openLinkAria: 'ูุชุญ ุฑุงุจุท ูุณู ูุน ุงูุฑูุฒ ุงูุญุงูู',
        next: 'ุงูุชุงูู',
        nextAria: 'ุนุฑุถ ุงูุฑูุฒ ุงูุชุงูู',
        actionsAria: 'ุฅุฌุฑุงุกุงุช ุงูุฑูุฒ',
        codeDisplayAria: 'ุนุฑุถ ุงูุฑูุฒ',
        copied: 'ุชู ุงููุณุฎ!',
        prayerAr: 'ูุง ุชููุณููุง ูู ุฏุนุงุฆู ุจุงูุนูุฑุฉ ูุงูุญุฌ',
        prayerEn: "Don't forget to keep us in your prayers for Umrah and Hajj",
        prayerAria: 'ุฏุนุงุก',
        shareBtn: 'ุดุงุฑููุง ุงูุฃุฌุฑ ูุงูุซูุงุจ ุจูุดุฑ ุงูุฃุฏุงุฉ',
        shareBtnAria: 'ูุดุงุฑูุฉ ุงูุฃุฏุงุฉ',
        shareTitle: 'ุดุงุฑููุง ุงูุฃุฌุฑ ูุงูุซูุงุจ',
        shareSubtitle: 'ุงูุดุฑ ุงูุฃุฏุงุฉ ูุณุงุนุฏ ุบูุฑู ูุฏุฎู ูุณุงุจูุฉ ูุณู ุงูุฑูุถุงููุฉ',
        shareModalAria: 'ูุดุงุฑูุฉ ุงูุฃุฏุงุฉ',
        shareCloseAria: 'ุฅุบูุงู',
        shareWhatsApp: 'ูุงุชุณุงุจ',
        shareFacebook: 'ููุณุจูู',
        shareCopyLink: 'ูุณุฎ ุงูุฑุงุจุท',
        shareWhatsAppAria: 'ูุดุงุฑูุฉ ุนุจุฑ ูุงุชุณุงุจ',
        shareFacebookAria: 'ูุดุงุฑูุฉ ุนุจุฑ ููุณุจูู',
        shareXAria: 'ูุดุงุฑูุฉ ุนุจุฑ X',
        shareCopyLinkAria: 'ูุณุฎ ุงูุฑุงุจุท',
        howToTitle: 'ููู ุชุณุชุฎุฏู ุงูููุชุงุญุ',
        howToAria: 'ุทุฑููุฉ ุงูุงุณุชุฎุฏุงู',
        howToStep1: 'ุงูุณุฎ ุงูููุฏ ุฃุนูุงู ุฃู ุงุถุบุท <strong>"ูุชุญ ุงูุฑุงุจุท"</strong>',
        howToStep2: 'ุงูุชุญ ุชุทุจูู <strong>ูุณู (Nusuk)</strong> ูุงุฏุฎู ุนูู <strong>ุชุญุฏู ูุณู</strong>',
        howToStep3: 'ุงุฎุชุฑ <strong>"ุงูููุงุชูุญ"</strong> ูู ุตูุญุฉ ุงูุชุญุฏู',
        howToStep4: 'ุงูุตู ุงูููุฏ ูุงุถุบุท <strong>"ุชุญูู ูู ุงูุฑูุฒ"</strong>',
        howToStep5: 'ุฃุฌุจ ุนูู ุฃุณุฆูุฉ ูู <strong>ุงูุฃุฑุจุน ุฃุจูุงุจ</strong>',
        howToStep6: 'ุณุชุฏุฎู ุชููุงุฆููุง ูู ุงูุณุญุจ ุงููููู ุนูู <strong>ุนูุฑุฉ ูุฌุงููุฉ</strong>',
        howToNote: 'ุชุญุชุงุฌ ููุท ุฅูู <strong>ูกู ููุงุชูุญ ูููููุง</strong> ููุฅุฌุงุจุฉ ุนูู ูกู ุฃุณุฆูุฉ',
        footerDev: 'ุทููุฑู',
        footerName: 'ุทุงุฑู ูุญูุฏ ุนุจุฏุงููู',
        socialAria: 'ุฑูุงุจุท ุงูุชูุงุตู ุงูุงุฌุชูุงุนู',
        githubAria: 'GitHub - ุทุงุฑู ูุญูุฏ ุนุจุฏุงููู',
        facebookAria: 'Facebook - ุทุงุฑู ูุญูุฏ ุนุจุฏุงููู',
        langToggle: 'Change Language',
        langToggleAria: 'Switch to English',

        allUsed: 'ุชู ุงุณุชุฎุฏุงู ุฌููุน ุงูุฃููุงุฏ! ๐',
        allUsedAria: 'ุชู ุงุณุชุฎุฏุงู ุฌููุน ุงูุฃููุงุฏ',
        progressAll: '{used} / {total} ููุฏ ูุณุชุฎุฏู',
        progressRemaining: '{used} ูุณุชุฎุฏู โข {remaining} ูุชุจูู',
        currentCodeAria: 'ุงูุฑูุฒ ุงูุญุงูู: {code}',
        shareText: 'ุฃุฏุงุฉ ุชุฌูุน ุฃูุซุฑ ูู ูกูงูู ููุชุงุญ ููุณุงุจูุฉ ูุณู ุงูุฑูุถุงููุฉ ๐\nุฌุงูุจ ุนูู ุงูุฃุณุฆูุฉ ูุงุฏุฎู ุงูุณุญุจ ุงููููู ููููุฒ ุจุฑุญูุฉ ุนูุฑุฉ ูุงููุฉ ๐',
        shareNativeTitle: 'ููุงุชูุญ ูุณุงุจูุฉ ูุณู ุงูุฑูุถุงููุฉ ููููุฒ ุจุนูุฑุฉ',
    },
    en: {
        skipLink: 'Skip to main content',
        logoAlt: 'Nusuk Keys Logo',
        title: 'Free Nusuk Keys',
        subtitle: 'Nusuk Ramadan Quiz 1447H โ Win Umrah Daily',
        loading: 'Loading...',
        codeHint: 'Click to copy the code. Press Space or Enter for the next code.',
        copy: 'Copy',
        copyAria: 'Copy current code',
        openLink: 'Open Link',
        openLinkAria: 'Open Nusuk link with current code',
        next: 'Next',
        nextAria: 'Show next code',
        actionsAria: 'Code actions',
        codeDisplayAria: 'Code display',
        copied: 'Copied!',
        prayerAr: 'ูุง ุชููุณููุง ูู ุฏุนุงุฆู ุจุงูุนูุฑุฉ ูุงูุญุฌ',
        prayerEn: "Don't forget to keep us in your prayers for Umrah and Hajj",
        prayerAria: 'Prayer',
        shareBtn: 'Share & earn the reward by spreading this tool',
        shareBtnAria: 'Share this tool',
        shareTitle: 'Share & Earn the Reward',
        shareSubtitle: 'Help others enter the Nusuk Ramadan Quiz',
        shareModalAria: 'Share this tool',
        shareCloseAria: 'Close',
        shareWhatsApp: 'WhatsApp',
        shareFacebook: 'Facebook',
        shareCopyLink: 'Copy Link',
        shareWhatsAppAria: 'Share via WhatsApp',
        shareFacebookAria: 'Share via Facebook',
        shareXAria: 'Share via X',
        shareCopyLinkAria: 'Copy link',
        howToTitle: 'How to use the key?',
        howToAria: 'How to use',
        howToStep1: 'Copy the code above or press <strong>"Open Link"</strong>',
        howToStep2: 'Open the <strong>Nusuk app</strong> and go to <strong>Nusuk Challenge</strong>',
        howToStep3: 'Choose <strong>"Keys"</strong> from the challenge page',
        howToStep4: 'Paste the code and press <strong>"Verify Code"</strong>',
        howToStep5: 'Answer questions from the <strong>4 sections</strong>',
        howToStep6: 'You\'ll automatically enter the daily draw for a <strong>free Umrah</strong>',
        howToNote: 'You only need <strong>10 keys per day</strong> to answer 10 questions',
        footerDev: 'Developed by',
        footerName: 'Tarek Mohamed Abdulla',
        socialAria: 'Social media links',
        githubAria: 'GitHub - Tarek Mohamed Abdulla',
        facebookAria: 'Facebook - Tarek Mohamed Abdulla',
        langToggle: 'ุชุบููุฑ ุงููุบุฉ',
        langToggleAria: 'ุงูุชุจุฏูู ุฅูู ุงูุนุฑุจูุฉ',

        allUsed: 'All codes have been used! ๐',
        allUsedAria: 'All codes have been used',
        progressAll: '{used} / {total} codes used',
        progressRemaining: '{used} used โข {remaining} remaining',
        currentCodeAria: 'Current code: {code}',
        shareText: 'A tool with 1700+ free keys for the Nusuk Ramadan Quiz ๐\nAnswer questions and enter the daily draw to win a full Umrah trip ๐',
        shareNativeTitle: 'Nusuk Ramadan Quiz Keys โ Win Umrah',
    }
};

let currentLang = 'ar';

function detectLanguage() {
    const stored = localStorage.getItem('lang');
    if (stored && TRANSLATIONS[stored]) return stored;

    const browserLang = (navigator.language || navigator.userLanguage || '').toLowerCase();
    if (browserLang.startsWith('ar')) return 'ar';
    return 'en';
}

function t(key, params) {
    const str = TRANSLATIONS[currentLang][key] || TRANSLATIONS['ar'][key] || key;
    if (!params) return str;
    return str.replace(/\{(\w+)\}/g, (_, k) => params[k] !== undefined ? params[k] : `{${k}}`);
}

function applyLanguage(lang, save) {
    currentLang = lang;
    const doc = document.documentElement;
    doc.lang = lang;
    doc.dir = lang === 'ar' ? 'rtl' : 'ltr';

    document.querySelectorAll('[data-i18n]').forEach(el => {
        el.textContent = t(el.dataset.i18n);
    });

    document.querySelectorAll('[data-i18n-html]').forEach(el => {
        el.innerHTML = t(el.dataset.i18nHtml);
    });

    document.querySelectorAll('[data-i18n-aria]').forEach(el => {
        el.setAttribute('aria-label', t(el.dataset.i18nAria));
    });

    document.querySelectorAll('[data-i18n-alt]').forEach(el => {
        el.alt = t(el.dataset.i18nAlt);
    });

    const toggle = document.getElementById('langToggle');
    if (toggle) {
        toggle.textContent = t('langToggle');
        toggle.setAttribute('aria-label', t('langToggleAria'));
    }

    if (save !== false) localStorage.setItem('lang', lang);
}

function toggleLanguage() {
    applyLanguage(currentLang === 'ar' ? 'en' : 'ar');
    if (typeof onLanguageChanged === 'function') onLanguageChanged();
}
